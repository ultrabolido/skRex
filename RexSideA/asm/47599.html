<!DOCTYPE html>
<html>
<head>
<title>Rex (Side A): Routine at B9EF</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="47502.html">B98E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47599">Map</a></td>
<td class="next">
Next: <a href="47677.html">BA3D</a>
</td>
</tr>
</table>
<div class="description">B9EF: Handle weapon energy loss</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="45938.html">B372</a> and <a href="47677.html">BA3D</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">The quantity of energy to loss</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="47599"></span>B9EF</td>
<td class="instruction">LD HL,$A093</td>
<td class="comment-1" rowspan="2">Set <a href="41107.html">A093</a> to the energy to loss</td>
</tr>
<tr>
<td class="address-1"><span id="47602"></span>B9F2</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="47603"></span>B9F3</td>
<td class="instruction">LD A,($A014)</td>
<td class="comment-1" rowspan="3">Return if weapon energy level equals zero</td>
</tr>
<tr>
<td class="address-1"><span id="47606"></span>B9F6</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="47607"></span>B9F7</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="47608"></span>B9F8</td>
<td class="instruction">LD A,($A018)</td>
<td class="comment-1" rowspan="3">Decrement weapon energy</td>
</tr>
<tr>
<td class="address-1"><span id="47611"></span>B9FB</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="47612"></span>B9FC</td>
<td class="instruction">LD ($A018),A</td>
</tr>
<tr>
<td class="address-1"><span id="47615"></span>B9FF</td>
<td class="instruction">RET P</td>
<td class="comment-1" rowspan="1">Return if energy still a positive value</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47616"></span>
<div class="comments">
<div class="paragraph">
Weapon energy quantity has been depleated
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="47616"></span>BA00</td>
<td class="instruction">ADD A,$32</td>
<td class="comment-1" rowspan="2">Increment weapon energy by 50</td>
</tr>
<tr>
<td class="address-1"><span id="47618"></span>BA02</td>
<td class="instruction">LD ($A018),A</td>
</tr>
<tr>
<td class="address-1"><span id="47621"></span>BA05</td>
<td class="instruction">LD A,($A014)</td>
<td class="comment-1" rowspan="2">Decrement weapon energy level</td>
</tr>
<tr>
<td class="address-1"><span id="47624"></span>BA08</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="47625"></span>BA09</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">if weapon energy level reaches zero jump forward</td>
</tr>
<tr>
<td class="address-1"><span id="47626"></span>BA0A</td>
<td class="instruction">JP Z,$BA11</td>
</tr>
<tr>
<td class="address-1"><span id="47629"></span>BA0D</td>
<td class="instruction">LD ($A014),A</td>
<td class="comment-1" rowspan="1">Set the new weapon energy level</td>
</tr>
<tr>
<td class="address-1"><span id="47632"></span>BA10</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47633"></span>
<div class="comments">
<div class="paragraph">
weapon energy level is zero
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47633"></span>BA11</td>
<td class="instruction">LD A,($A06E)</td>
<td class="comment-1" rowspan="2">Decrement the accumulated energy for weapons</td>
</tr>
<tr>
<td class="address-1"><span id="47636"></span>BA14</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="47637"></span>BA15</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="2">Return if the accumulated energy is alredy zero</td>
</tr>
<tr>
<td class="address-1"><span id="47639"></span>BA17</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="47640"></span>BA18</td>
<td class="instruction">LD ($A06E),A</td>
<td class="comment-1" rowspan="1">Set the new number of accumulated energy for weapon</td>
</tr>
<tr>
<td class="address-1"><span id="47643"></span>BA1B</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="1">Set color attribute blue for weapon icon</td>
</tr>
<tr>
<td class="address-1"><span id="47645"></span>BA1D</td>
<td class="instruction">LD HL,($A015)</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to point to the current weapon icon HUD in attribute file</td>
</tr>
<tr>
<td class="address-1"><span id="47648"></span>BA20</td>
<td class="instruction">CALL <a href="47467.html#47491">$B983</a></td>
<td class="comment-1" rowspan="1">Set weapon icon in HUD to the color at <span class="register">A</span> (aatribute file)</td>
</tr>
<tr>
<td class="address-1"><span id="47651"></span>BA23</td>
<td class="instruction">LD HL,($A015)</td>
<td class="comment-1" rowspan="3">Point <span class="register">HL</span> to the weapon icon into the attribute buffer</td>
</tr>
<tr>
<td class="address-1"><span id="47654"></span>BA26</td>
<td class="instruction">LD DE,$8CFF</td>
</tr>
<tr>
<td class="address-1"><span id="47657"></span>BA29</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="47658"></span>BA2A</td>
<td class="instruction">CALL <a href="47467.html#47491">$B983</a></td>
<td class="comment-1" rowspan="1">Set weapon icon in HUD to the color at <span class="register">A</span> (attribute buffer)</td>
</tr>
<tr>
<td class="address-1"><span id="47661"></span>BA2D</td>
<td class="instruction">LD HL,($A015)</td>
<td class="comment-1" rowspan="4">Set <a href="40981.html">A015</a> to point to the previous weapon icon</td>
</tr>
<tr>
<td class="address-1"><span id="47664"></span>BA30</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="47665"></span>BA31</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="47666"></span>BA32</td>
<td class="instruction">LD ($A015),HL</td>
</tr>
<tr>
<td class="address-1"><span id="47669"></span>BA35</td>
<td class="instruction">LD A,$05</td>
<td class="comment-1" rowspan="2">Set weapon energy level to max</td>
</tr>
<tr>
<td class="address-1"><span id="47671"></span>BA37</td>
<td class="instruction">LD ($A014),A</td>
</tr>
<tr>
<td class="address-1"><span id="47674"></span>BA3A</td>
<td class="instruction">JP <a href="47502.html#47575">$B9D7</a></td>
<td class="comment-1" rowspan="1">Jump to change the current weapon for Rex</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="47502.html">B98E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47599">Map</a></td>
<td class="next">
Next: <a href="47677.html">BA3D</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side A) RAM disassembly 20210825</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>