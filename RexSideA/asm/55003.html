<!DOCTYPE html>
<html>
<head>
<title>Rex (Side A): Routine at D6DB</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="54924.html">D68C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#55003">Map</a></td>
<td class="next">
Next: <a href="55108.html">D744</a>
</td>
</tr>
</table>
<div class="description">D6DB: Configure note for current channel</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="54924.html">D68C</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">address pointer to channel data buffer</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="55003"></span>D6DB</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="3">Return if channel is not active</td>
</tr>
<tr>
<td class="address-1"><span id="55006"></span>D6DE</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address-1"><span id="55008"></span>D6E0</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="55009"></span>D6E1</td>
<td class="instruction">CALL <a href="55108.html">$D744</a></td>
<td class="comment-1" rowspan="1">Send channel volume command</td>
</tr>
<tr>
<td class="address-1"><span id="55012"></span>D6E4</td>
<td class="instruction">CALL <a href="55129.html">$D759</a></td>
<td class="comment-1" rowspan="1">Send channel volume command</td>
</tr>
<tr>
<td class="address-1"><span id="55015"></span>D6E7</td>
<td class="instruction">LD L,(IX+$02)</td>
<td class="comment-1" rowspan="4">Set <span class="register">IY</span> to the address pointer for the sound data</td>
</tr>
<tr>
<td class="address-1"><span id="55018"></span>D6EA</td>
<td class="instruction">LD H,(IX+$03)</td>
</tr>
<tr>
<td class="address-1"><span id="55021"></span>D6ED</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address-1"><span id="55022"></span>D6EE</td>
<td class="instruction">POP IY</td>
</tr>
<tr>
<td class="address-1"><span id="55024"></span>D6F0</td>
<td class="instruction">DEC (IX+$01)</td>
<td class="comment-1" rowspan="1">Decrement variation counter</td>
</tr>
<tr>
<td class="address-1"><span id="55027"></span>D6F3</td>
<td class="instruction">JP Z,$D715</td>
<td class="comment-1" rowspan="1">If counter is 0 jump to configure next note</td>
</tr>
<tr>
<td class="address-1"><span id="55030"></span>D6F6</td>
<td class="instruction">LD E,(IY+$01)</td>
<td class="comment-1" rowspan="5">Set <span class="register">BC</span> value of pitch and coarse delta</td>
</tr>
<tr>
<td class="address-1"><span id="55033"></span>D6F9</td>
<td class="instruction">LD C,E</td>
</tr>
<tr>
<td class="address-1"><span id="55034"></span>D6FA</td>
<td class="instruction">RL E</td>
</tr>
<tr>
<td class="address-1"><span id="55036"></span>D6FC</td>
<td class="instruction">SBC A,A</td>
</tr>
<tr>
<td class="address-1"><span id="55037"></span>D6FD</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="55038"></span>D6FE</td>
<td class="instruction">LD L,(IX+$04)</td>
<td class="comment-1" rowspan="5">Increment pitch and coarse data for tone/noise</td>
</tr>
<tr>
<td class="address-1"><span id="55041"></span>D701</td>
<td class="instruction">LD H,(IX+$05)</td>
</tr>
<tr>
<td class="address-1"><span id="55044"></span>D704</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="55045"></span>D705</td>
<td class="instruction">LD (IX+$04),L</td>
</tr>
<tr>
<td class="address-1"><span id="55048"></span>D708</td>
<td class="instruction">LD (IX+$05),H</td>
</tr>
<tr>
<td class="address-1"><span id="55051"></span>D70B</td>
<td class="instruction">LD A,(IX+$07)</td>
<td class="comment-1" rowspan="3">Increment/decrement volume</td>
</tr>
<tr>
<td class="address-1"><span id="55054"></span>D70E</td>
<td class="instruction">ADD A,(IY+$02)</td>
</tr>
<tr>
<td class="address-1"><span id="55057"></span>D711</td>
<td class="instruction">LD (IX+$07),A</td>
</tr>
<tr>
<td class="address-1"><span id="55060"></span>D714</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55061"></span>
<div class="comments">
<div class="paragraph">
check if there are more tones
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="55061"></span>D715</td>
<td class="instruction">DEC (IX+$00)</td>
<td class="comment-1" rowspan="1">Decrement tones number?</td>
</tr>
<tr>
<td class="address-1"><span id="55064"></span>D718</td>
<td class="instruction">JP Z,$D733</td>
<td class="comment-1" rowspan="1">if zero jump to disable channel</td>
</tr>
<tr>
<td class="address-1"><span id="55067"></span>D71B</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="3">Point <span class="register">IY</span> to the next tone data</td>
</tr>
<tr>
<td class="address-1"><span id="55069"></span>D71D</td>
<td class="instruction">INC IY</td>
</tr>
<tr>
<td class="address-1"><span id="55071"></span>D71F</td>
<td class="instruction">INC IY</td>
</tr>
<tr>
<td class="address-1"><span id="55073"></span>D721</td>
<td class="instruction">PUSH IY</td>
<td class="comment-1" rowspan="4">Update address pointer to tone data</td>
</tr>
<tr>
<td class="address-1"><span id="55075"></span>D723</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address-1"><span id="55076"></span>D724</td>
<td class="instruction">LD (IX+$02),L</td>
</tr>
<tr>
<td class="address-1"><span id="55079"></span>D727</td>
<td class="instruction">LD (IX+$03),H</td>
</tr>
<tr>
<td class="address-1"><span id="55082"></span>D72A</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="2">Set new variation counter</td>
</tr>
<tr>
<td class="address-1"><span id="55085"></span>D72D</td>
<td class="instruction">LD (IX+$01),A</td>
</tr>
<tr>
<td class="address-1"><span id="55088"></span>D730</td>
<td class="instruction">JP $D6DB</td>
<td class="comment-1" rowspan="1">Configure next tone</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55091"></span>
<div class="comments">
<div class="paragraph">
disable channel
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="55091"></span>D733</td>
<td class="instruction">LD A,($D857)</td>
<td class="comment-1" rowspan="4">Set volume to zero for current channel</td>
</tr>
<tr>
<td class="address-1"><span id="55094"></span>D736</td>
<td class="instruction">ADD A,$07</td>
</tr>
<tr>
<td class="address-1"><span id="55096"></span>D738</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-1"><span id="55097"></span>D739</td>
<td class="instruction">LD E,$00</td>
</tr>
<tr>
<td class="address-1"><span id="55099"></span>D73B</td>
<td class="instruction">CALL <a href="55129.html">$D759</a></td>
<td class="comment-1" rowspan="1">Send volume command</td>
</tr>
<tr>
<td class="address-1"><span id="55102"></span>D73E</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-1" rowspan="2">Disable current channel</td>
</tr>
<tr>
<td class="address-1"><span id="55104"></span>D740</td>
<td class="instruction">LD (IX+$00),A</td>
</tr>
<tr>
<td class="address-1"><span id="55107"></span>D743</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="54924.html">D68C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#55003">Map</a></td>
<td class="next">
Next: <a href="55108.html">D744</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side A) RAM disassembly 20210825</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>