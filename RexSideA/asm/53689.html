<!DOCTYPE html>
<html>
<head>
<title>Rex (Side A): Routine at D1B9</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="53581.html">D14D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#53689">Map</a></td>
<td class="next">
Next: <a href="53781.html">D215</a>
</td>
</tr>
</table>
<div class="description">D1B9: Handle enemy projectile collision with Rex</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="38010.html">947A</a> and <a href="43285.html">A915</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="53689"></span>D1B9</td>
<td class="instruction">LD A,($A055)</td>
<td class="comment-1" rowspan="3">Return if Rex is dead</td>
</tr>
<tr>
<td class="address-1"><span id="53692"></span>D1BC</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="53693"></span>D1BD</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="53694"></span>D1BE</td>
<td class="instruction">LD A,($A060)</td>
<td class="comment-1" rowspan="3">Return if Rex is teleporting</td>
</tr>
<tr>
<td class="address-1"><span id="53697"></span>D1C1</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="53698"></span>D1C2</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="53699"></span>D1C3</td>
<td class="instruction">LD IY,$5D22</td>
<td class="comment-1" rowspan="1">Set <span class="register">IY</span> to base address for enemy projectiles</td>
</tr>
<tr>
<td class="address-1"><span id="53703"></span>D1C7</td>
<td class="instruction">LD B,$14</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span> to the number of projectiles to check</td>
</tr>
<tr>
<td class="address-2"><span id="53705"></span>D1C9</td>
<td class="instruction">LD A,(IY+$06)</td>
<td class="comment-1" rowspan="1">check projectile status</td>
</tr>
<tr>
<td class="address-1"><span id="53708"></span>D1CC</td>
<td class="instruction">CP $01</td>
<td class="comment-1" rowspan="1">is flying?</td>
</tr>
<tr>
<td class="address-1"><span id="53710"></span>D1CE</td>
<td class="instruction">JP NZ,$D20B</td>
<td class="comment-1" rowspan="1">Jump forward and check next projectile if not flying</td>
</tr>
<tr>
<td class="address-1"><span id="53713"></span>D1D1</td>
<td class="instruction">LD A,($A0B7)</td>
<td class="comment-1" rowspan="7">Check if projectile y-position is in range of collision based on Rex y-position</td>
</tr>
<tr>
<td class="address-1"><span id="53716"></span>D1D4</td>
<td class="instruction">ADD A,$05</td>
</tr>
<tr>
<td class="address-1"><span id="53718"></span>D1D6</td>
<td class="instruction">CP (IY+$01)</td>
</tr>
<tr>
<td class="address-1"><span id="53721"></span>D1D9</td>
<td class="instruction">JP NC,$D20B</td>
</tr>
<tr>
<td class="address-1"><span id="53724"></span>D1DC</td>
<td class="instruction">ADD A,$11</td>
</tr>
<tr>
<td class="address-1"><span id="53726"></span>D1DE</td>
<td class="instruction">CP (IY+$01)</td>
</tr>
<tr>
<td class="address-1"><span id="53729"></span>D1E1</td>
<td class="instruction">JP C,$D20B</td>
</tr>
<tr>
<td class="address-1"><span id="53732"></span>D1E4</td>
<td class="instruction">LD A,($A0B6)</td>
<td class="comment-1" rowspan="6">Check if projectile x-position is in range of collision based on Rex x-position</td>
</tr>
<tr>
<td class="address-1"><span id="53735"></span>D1E7</td>
<td class="instruction">CP (IY+$00)</td>
</tr>
<tr>
<td class="address-1"><span id="53738"></span>D1EA</td>
<td class="instruction">JP NC,$D20B</td>
</tr>
<tr>
<td class="address-1"><span id="53741"></span>D1ED</td>
<td class="instruction">ADD A,$10</td>
</tr>
<tr>
<td class="address-1"><span id="53743"></span>D1EF</td>
<td class="instruction">CP (IY+$00)</td>
</tr>
<tr>
<td class="address-1"><span id="53746"></span>D1F2</td>
<td class="instruction">JP C,$D20B</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="53749"></span>
<div class="comments">
<div class="paragraph">
Impact with Rex
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="53749"></span>D1F5</td>
<td class="instruction">LD (IY+$06),$02</td>
<td class="comment-1" rowspan="1">Set projectile status to impact #1</td>
</tr>
<tr>
<td class="address-1"><span id="53753"></span>D1F9</td>
<td class="instruction">LD A,($A049)</td>
<td class="comment-1" rowspan="1">Check if Rex has the shield activated</td>
</tr>
<tr>
<td class="address-1"><span id="53756"></span>D1FC</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Jump to kill Rex if shield not active</td>
</tr>
<tr>
<td class="address-1"><span id="53757"></span>D1FD</td>
<td class="instruction">JP Z,$D208</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="53760"></span>
<div class="comments">
<div class="paragraph">
Shield activated
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="53760"></span>D200</td>
<td class="instruction">LD L,$05</td>
<td class="comment-1" rowspan="1">Set <span class="register">L</span> to the shield loss quantity</td>
</tr>
<tr>
<td class="address-1"><span id="53762"></span>D202</td>
<td class="instruction">CALL <a href="39374.html">$99CE</a></td>
<td class="comment-1" rowspan="1">Handle shield loss</td>
</tr>
<tr>
<td class="address-1"><span id="53765"></span>D205</td>
<td class="instruction">JP $D20B</td>
<td class="comment-1" rowspan="1">Jump to handle next projectile</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="53768"></span>
<div class="comments">
<div class="paragraph">
Shield not activated
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="53768"></span>D208</td>
<td class="instruction">CALL <a href="39898.html">$9BDA</a></td>
<td class="comment-1" rowspan="1">Kill Rex</td>
</tr>
<tr>
<td class="address-2"><span id="53771"></span>D20B</td>
<td class="instruction">LD DE,$000F</td>
<td class="comment-1" rowspan="2">Point <span class="register">IY</span> to the next projectile data</td>
</tr>
<tr>
<td class="address-1"><span id="53774"></span>D20E</td>
<td class="instruction">ADD IY,DE</td>
</tr>
<tr>
<td class="address-1"><span id="53776"></span>D210</td>
<td class="instruction">DEC B</td>
<td class="comment-1" rowspan="1">Decrement projectile counter</td>
</tr>
<tr>
<td class="address-1"><span id="53777"></span>D211</td>
<td class="instruction">JP NZ,$D1C9</td>
<td class="comment-1" rowspan="1">Jump back and check next projectile</td>
</tr>
<tr>
<td class="address-1"><span id="53780"></span>D214</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="53581.html">D14D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#53689">Map</a></td>
<td class="next">
Next: <a href="53781.html">D215</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side A) RAM disassembly 20210825</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>