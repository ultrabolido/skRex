<!DOCTYPE html>
<html>
<head>
<title>Rex (Side A): Routine at A402</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="41928.html">A3C8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#41986">Map</a></td>
<td class="next">
Next: <a href="42090.html">A46A</a>
</td>
</tr>
</table>
<div class="description">A402: Convert a number into a list of digits charcodes</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Computes the charcode of the number in <span class="register">HL</span> and puts every digit charcode into $A0A6-$A0AA (in reverse order) $A0A6 units, $A0A7 tens, $A0A8 hundreds, $A0A9 thousands and $A0AA ten thousands Used by the routines at <a href="39339.html">99AB</a>, <a href="39355.html">99BB</a>, <a href="39418.html">99FA</a>, <a href="40054.html">9C76</a> and <a href="42958.html">A7CE</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Number to convert</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="41986"></span>A402</td>
<td class="instruction">PUSH IX</td>
<td class="comment-1" rowspan="1">Save <span class="register">IX</span></td>
</tr>
<tr>
<td class="address-1"><span id="41988"></span>A404</td>
<td class="instruction">LD ($A0A4),HL</td>
<td class="comment-1" rowspan="1">Save the number in $A0A4</td>
</tr>
<tr>
<td class="address-1"><span id="41991"></span>A407</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="41992"></span>A408</td>
<td class="instruction">LD ($A0AA),A</td>
<td class="comment-1" rowspan="5">Init the charcode buffer</td>
</tr>
<tr>
<td class="address-1"><span id="41995"></span>A40B</td>
<td class="instruction">LD ($A0A9),A</td>
</tr>
<tr>
<td class="address-1"><span id="41998"></span>A40E</td>
<td class="instruction">LD ($A0A8),A</td>
</tr>
<tr>
<td class="address-1"><span id="42001"></span>A411</td>
<td class="instruction">LD ($A0A7),A</td>
</tr>
<tr>
<td class="address-1"><span id="42004"></span>A414</td>
<td class="instruction">LD ($A0A6),A</td>
</tr>
<tr>
<td class="address-1"><span id="42007"></span>A417</td>
<td class="instruction">LD DE,$2710</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span>=10.000</td>
</tr>
<tr>
<td class="address-1"><span id="42010"></span>A41A</td>
<td class="instruction">CALL $A447</td>
<td class="comment-1" rowspan="1">Computes the charcode for the digit in the ten thousands</td>
</tr>
<tr>
<td class="address-1"><span id="42013"></span>A41D</td>
<td class="instruction">LD ($A0AA),A</td>
<td class="comment-1" rowspan="1">Set this charcode into $A0AA</td>
</tr>
<tr>
<td class="address-1"><span id="42016"></span>A420</td>
<td class="instruction">LD DE,$03E8</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span>=1.000</td>
</tr>
<tr>
<td class="address-1"><span id="42019"></span>A423</td>
<td class="instruction">CALL $A447</td>
<td class="comment-1" rowspan="1">Computes the charcode for the digit in the thousands</td>
</tr>
<tr>
<td class="address-1"><span id="42022"></span>A426</td>
<td class="instruction">LD ($A0A9),A</td>
<td class="comment-1" rowspan="1">Set this charcode into $A0A9</td>
</tr>
<tr>
<td class="address-1"><span id="42025"></span>A429</td>
<td class="instruction">LD DE,$0064</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span>=100</td>
</tr>
<tr>
<td class="address-1"><span id="42028"></span>A42C</td>
<td class="instruction">CALL $A447</td>
<td class="comment-1" rowspan="1">Computes the charcode for the digit in the hundreds</td>
</tr>
<tr>
<td class="address-1"><span id="42031"></span>A42F</td>
<td class="instruction">LD ($A0A8),A</td>
<td class="comment-1" rowspan="1">Set this charcode into $A0A8</td>
</tr>
<tr>
<td class="address-1"><span id="42034"></span>A432</td>
<td class="instruction">LD DE,$000A</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span>=10</td>
</tr>
<tr>
<td class="address-1"><span id="42037"></span>A435</td>
<td class="instruction">CALL $A447</td>
<td class="comment-1" rowspan="1">Computes the charcode for the digit in the tens</td>
</tr>
<tr>
<td class="address-1"><span id="42040"></span>A438</td>
<td class="instruction">LD ($A0A7),A</td>
<td class="comment-1" rowspan="1">Set this charcode into $A0A7</td>
</tr>
<tr>
<td class="address-1"><span id="42043"></span>A43B</td>
<td class="instruction">LD DE,$0001</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span>=1</td>
</tr>
<tr>
<td class="address-1"><span id="42046"></span>A43E</td>
<td class="instruction">CALL $A447</td>
<td class="comment-1" rowspan="1">Computes the charcode for the digit in the units</td>
</tr>
<tr>
<td class="address-1"><span id="42049"></span>A441</td>
<td class="instruction">LD ($A0A6),A</td>
<td class="comment-1" rowspan="1">Set this charcode into $A0A6</td>
</tr>
<tr>
<td class="address-1"><span id="42052"></span>A444</td>
<td class="instruction">POP IX</td>
<td class="comment-1" rowspan="1">Restore <span class="register">IX</span></td>
</tr>
<tr>
<td class="address-1"><span id="42054"></span>A446</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="42055"></span>
<div class="comments">
<div class="paragraph">
Computes the charcode for the digit in the units, tens, hundreds, thousands o ten toushands
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="42055"></span>A447</td>
<td class="instruction">LD HL,($A0A4)</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to the number to convert</td>
</tr>
<tr>
<td class="address-1"><span id="42058"></span>A44A</td>
<td class="instruction">LD IX,$0000</td>
<td class="comment-1" rowspan="1">Set <span class="register">IX</span>=0. The part of the number that has been converted [ x0.000, x.000, x00, x0 or x }</td>
</tr>
<tr>
<td class="address-1"><span id="42062"></span>A44E</td>
<td class="instruction">LD B,$00</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span>=0. The digit number that we need to convert to charcode [x]</td>
</tr>
<tr>
<td class="address-2"><span id="42064"></span>A450</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Reset carry bit</td>
</tr>
<tr>
<td class="address-1"><span id="42065"></span>A451</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="1">Substract <span class="register">DE</span> [10.000, 1.000, 100, 10 or 1] to <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="42067"></span>A453</td>
<td class="instruction">JR C,$A45A</td>
<td class="comment-1" rowspan="1">Jump if the result in <span class="register">HL</span> is a negative number (<span class="register">DE</span> is greater than the number to convert)</td>
</tr>
<tr>
<td class="address-1"><span id="42069"></span>A455</td>
<td class="instruction">ADD IX,DE</td>
<td class="comment-1" rowspan="1">Add <span class="register">DE</span> to <span class="register">IX</span></td>
</tr>
<tr>
<td class="address-1"><span id="42071"></span>A457</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Increment the digit number</td>
</tr>
<tr>
<td class="address-1"><span id="42072"></span>A458</td>
<td class="instruction">JR $A450</td>
<td class="comment-1" rowspan="1">Jump back and repeat the process until obtain the digit number</td>
</tr>
<tr>
<td class="address-2"><span id="42074"></span>A45A</td>
<td class="instruction">PUSH IX</td>
<td class="comment-1" rowspan="2">Copy in <span class="register">DE</span> the value of <span class="register">IX</span></td>
</tr>
<tr>
<td class="address-1"><span id="42076"></span>A45C</td>
<td class="instruction">POP DE</td>
</tr>
<tr>
<td class="address-1"><span id="42077"></span>A45D</td>
<td class="instruction">LD HL,($A0A4)</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to the number to convert</td>
</tr>
<tr>
<td class="address-1"><span id="42080"></span>A460</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Reset carry bit</td>
</tr>
<tr>
<td class="address-1"><span id="42081"></span>A461</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="1">Substract to the number to convert the part just converted</td>
</tr>
<tr>
<td class="address-1"><span id="42083"></span>A463</td>
<td class="instruction">LD ($A0A4),HL</td>
<td class="comment-1" rowspan="1">Set into $A0A4 the remaining number to convert</td>
</tr>
<tr>
<td class="address-1"><span id="42086"></span>A466</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1">Copy into <span class="register">A</span> the digit number to convert</td>
</tr>
<tr>
<td class="address-1"><span id="42087"></span>A467</td>
<td class="instruction">ADD A,$30</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span> to the charcode of the digit ($30 is the base charcode for digit, i.e. is the 0 digit charcode)</td>
</tr>
<tr>
<td class="address-1"><span id="42089"></span>A469</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="41928.html">A3C8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#41986">Map</a></td>
<td class="next">
Next: <a href="42090.html">A46A</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side A) RAM disassembly 20210825</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>