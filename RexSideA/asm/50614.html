<!DOCTYPE html>
<html>
<head>
<title>Rex (Side A): Routine at C5B6</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="50551.html">C577</a>
</td>
<td class="up">Up: <a href="../maps/all.html#50614">Map</a></td>
<td class="next">
Next: <a href="50682.html">C5FA</a>
</td>
</tr>
</table>
<div class="description">C5B6: Handle FOOT MAN walking/crouching state change</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="47708.html">BA5C</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="50614"></span>C5B6</td>
<td class="instruction">LD A,(IX+$09)</td>
<td class="comment-1" rowspan="3">Entity type is FOOT MAN?</td>
</tr>
<tr>
<td class="address-1"><span id="50617"></span>C5B9</td>
<td class="instruction">AND $7F</td>
</tr>
<tr>
<td class="address-1"><span id="50619"></span>C5BB</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="50620"></span>C5BC</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if it isn't</td>
</tr>
<tr>
<td class="address-1"><span id="50621"></span>C5BD</td>
<td class="instruction">LD A,(IX+$12)</td>
<td class="comment-1" rowspan="2">FOOT MAN is walking?</td>
</tr>
<tr>
<td class="address-1"><span id="50624"></span>C5C0</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="50625"></span>C5C1</td>
<td class="instruction">JP Z,$C5EF</td>
<td class="comment-1" rowspan="1">Jump to decrement state counter</td>
</tr>
<tr>
<td class="address-1"><span id="50628"></span>C5C4</td>
<td class="instruction">LD A,(IX+$11)</td>
<td class="comment-1" rowspan="1">SEt <span class="register">A</span> to state counter</td>
</tr>
<tr>
<td class="address-1"><span id="50631"></span>C5C7</td>
<td class="instruction">CP $C8</td>
<td class="comment-1" rowspan="1">is for fixed crouch foot man?</td>
</tr>
<tr>
<td class="address-1"><span id="50633"></span>C5C9</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="50634"></span>C5CA</td>
<td class="instruction">DEC (IX+$11)</td>
<td class="comment-1" rowspan="1">Decrement state counter</td>
</tr>
<tr>
<td class="address-1"><span id="50637"></span>C5CD</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if no 0</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="50638"></span>
<div class="comments">
<div class="paragraph">
State counter reached 0: change state to walking
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="50638"></span>C5CE</td>
<td class="instruction">LD (IX+$10),$02</td>
<td class="comment-1" rowspan="1">Set footman speed</td>
</tr>
<tr>
<td class="address-1"><span id="50642"></span>C5D2</td>
<td class="instruction">RES 7,(IX+$09)</td>
<td class="comment-1" rowspan="1">Set footman walking type</td>
</tr>
<tr>
<td class="address-1"><span id="50646"></span>C5D6</td>
<td class="instruction">LD (IX+$0E),$03</td>
<td class="comment-1" rowspan="1">Set width of sprite (in bytes)</td>
</tr>
<tr>
<td class="address-1"><span id="50650"></span>C5DA</td>
<td class="instruction">LD (IX+$11),$09</td>
<td class="comment-1" rowspan="1">Set state counter</td>
</tr>
<tr>
<td class="address-1"><span id="50654"></span>C5DE</td>
<td class="instruction">LD A,(IX+$12)</td>
<td class="comment-1" rowspan="2">is footman stand-by?</td>
</tr>
<tr>
<td class="address-1"><span id="50657"></span>C5E1</td>
<td class="instruction">CP $02</td>
</tr>
<tr>
<td class="address-1"><span id="50659"></span>C5E3</td>
<td class="instruction">JP NZ,$C5EA</td>
<td class="comment-1" rowspan="1">Jump if walking or crouched</td>
</tr>
<tr>
<td class="address-1"><span id="50662"></span>C5E6</td>
<td class="instruction">LD (IX+$11),$01</td>
<td class="comment-1" rowspan="1">Set state counter</td>
</tr>
<tr>
<td class="address-2"><span id="50666"></span>C5EA</td>
<td class="instruction">LD (IX+$12),$00</td>
<td class="comment-1" rowspan="1">Set footman walking</td>
</tr>
<tr>
<td class="address-1"><span id="50670"></span>C5EE</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="50671"></span>C5EF</td>
<td class="instruction">LD A,(IX+$11)</td>
<td class="comment-1" rowspan="6">Decrement counter if counter &gt; 0</td>
</tr>
<tr>
<td class="address-1"><span id="50674"></span>C5F2</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="50675"></span>C5F3</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address-1"><span id="50677"></span>C5F5</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="50678"></span>C5F6</td>
<td class="instruction">LD (IX+$11),A</td>
</tr>
<tr>
<td class="address-1"><span id="50681"></span>C5F9</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="50551.html">C577</a>
</td>
<td class="up">Up: <a href="../maps/all.html#50614">Map</a></td>
<td class="next">
Next: <a href="50682.html">C5FA</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side A) RAM disassembly 20210825</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>