<!DOCTYPE html>
<html>
<head>
<title>Rex (Side A): Routine at C14D</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="49481.html">C149</a>
</td>
<td class="up">Up: <a href="../maps/all.html#49485">Map</a></td>
<td class="next">
Next: <a href="49610.html">C1CA</a>
</td>
</tr>
</table>
<div class="description">C14D: Handle BLOB and MINE movement</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="49135.html">BFEF</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="49485"></span>C14D</td>
<td class="instruction">CALL <a href="49376.html">$C0E0</a></td>
<td class="comment-1" rowspan="1">Handle collision detection for BLOB</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="49488"></span>
<div class="comments">
<div class="paragraph">
Handle for BLOB and MINE movement. This entry point is used by the routine at <a href="49135.html">BFEF</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="49488"></span>C150</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="3">Set new x-position based on x-delta</td>
</tr>
<tr>
<td class="address-1"><span id="49491"></span>C153</td>
<td class="instruction">ADD A,(IX+$04)</td>
</tr>
<tr>
<td class="address-1"><span id="49494"></span>C156</td>
<td class="instruction">LD (IX+$00),A</td>
</tr>
<tr>
<td class="address-1"><span id="49497"></span>C159</td>
<td class="instruction">LD A,(IX+$01)</td>
<td class="comment-1" rowspan="3">Set new y-position based on y-delta</td>
</tr>
<tr>
<td class="address-1"><span id="49500"></span>C15C</td>
<td class="instruction">ADD A,(IX+$05)</td>
</tr>
<tr>
<td class="address-1"><span id="49503"></span>C15F</td>
<td class="instruction">LD (IX+$01),A</td>
</tr>
<tr>
<td class="address-1"><span id="49506"></span>C162</td>
<td class="instruction">LD A,(IX+$09)</td>
<td class="comment-1" rowspan="1">Check enemy type</td>
</tr>
<tr>
<td class="address-1"><span id="49509"></span>C165</td>
<td class="instruction">CP $0F</td>
<td class="comment-1" rowspan="2">Jump forward if BLOB</td>
</tr>
<tr>
<td class="address-1"><span id="49511"></span>C167</td>
<td class="instruction">JP Z,$C179</td>
</tr>
<tr>
<td class="address-1"><span id="49514"></span>C16A</td>
<td class="instruction">LD HL,($A01B)</td>
<td class="comment-1" rowspan="4">Set <span class="register">HL</span> to the address into tile buffer for MINE</td>
</tr>
<tr>
<td class="address-1"><span id="49517"></span>C16D</td>
<td class="instruction">LD DE,$0020</td>
</tr>
<tr>
<td class="address-1"><span id="49520"></span>C170</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="49521"></span>C171</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="49523"></span>C173</td>
<td class="instruction">CALL <a href="53356.html">$D06C</a></td>
<td class="comment-1" rowspan="1">is a wall tile type?</td>
</tr>
<tr>
<td class="address-1"><span id="49526"></span>C176</td>
<td class="instruction">JP Z,<a href="38943.html">$981F</a></td>
<td class="comment-1" rowspan="1">Jump to destroy MINE if so</td>
</tr>
<tr>
<td class="address-2"><span id="49529"></span>C179</td>
<td class="instruction">DEC (IX+$11)</td>
<td class="comment-1" rowspan="1">Decrement state change counter</td>
</tr>
<tr>
<td class="address-1"><span id="49532"></span>C17C</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if no zero</td>
</tr>
<tr>
<td class="address-1"><span id="49533"></span>C17D</td>
<td class="instruction">LD A,R</td>
<td class="comment-1" rowspan="3">Set <span class="register">A</span> a random number between 2-5</td>
</tr>
<tr>
<td class="address-1"><span id="49535"></span>C17F</td>
<td class="instruction">AND $03</td>
</tr>
<tr>
<td class="address-1"><span id="49537"></span>C181</td>
<td class="instruction">ADD A,$02</td>
</tr>
<tr>
<td class="address-1"><span id="49539"></span>C183</td>
<td class="instruction">LD (IX+$11),A</td>
<td class="comment-1" rowspan="1">Reset state change counter</td>
</tr>
<tr>
<td class="address-1"><span id="49542"></span>C186</td>
<td class="instruction">LD A,(IX+$09)</td>
<td class="comment-1" rowspan="1">Check enemy type</td>
</tr>
<tr>
<td class="address-1"><span id="49545"></span>C189</td>
<td class="instruction">CP $0F</td>
<td class="comment-1" rowspan="2">Jump forward if BLOB</td>
</tr>
<tr>
<td class="address-1"><span id="49547"></span>C18B</td>
<td class="instruction">JP Z,$C198</td>
</tr>
<tr>
<td class="address-1"><span id="49550"></span>C18E</td>
<td class="instruction">LD A,(IX+$12)</td>
<td class="comment-1" rowspan="3">Change state for MINE</td>
</tr>
<tr>
<td class="address-1"><span id="49553"></span>C191</td>
<td class="instruction">XOR $01</td>
</tr>
<tr>
<td class="address-1"><span id="49555"></span>C193</td>
<td class="instruction">LD (IX+$12),A</td>
</tr>
<tr>
<td class="address-1"><span id="49558"></span>C196</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Return if MINE continue fixed movement</td>
</tr>
<tr>
<td class="address-1"><span id="49559"></span>C197</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-2"><span id="49560"></span>C198</td>
<td class="instruction">LD A,R</td>
<td class="comment-1" rowspan="3">Set <span class="register">A</span> a random number between 8 and 15</td>
</tr>
<tr>
<td class="address-1"><span id="49562"></span>C19A</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="49564"></span>C19C</td>
<td class="instruction">ADD A,$08</td>
</tr>
<tr>
<td class="address-1"><span id="49566"></span>C19E</td>
<td class="instruction">LD (IX+$11),A</td>
<td class="comment-1" rowspan="1">Reset state change counter with this number</td>
</tr>
<tr>
<td class="address-1"><span id="49569"></span>C1A1</td>
<td class="instruction">LD A,(IX+$09)</td>
<td class="comment-1" rowspan="3">Jump to define x/y-delta for BLOB</td>
</tr>
<tr>
<td class="address-1"><span id="49572"></span>C1A4</td>
<td class="instruction">CP $0F</td>
</tr>
<tr>
<td class="address-1"><span id="49574"></span>C1A6</td>
<td class="instruction">JP Z,<a href="49454.html">$C12E</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="49577"></span>
<div class="comments">
<div class="paragraph">
Set x/y-delta for MINE
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="49577"></span>C1A9</td>
<td class="instruction">LD (IX+$04),$01</td>
<td class="comment-1" rowspan="1">Set x-delta to 1 for MINE</td>
</tr>
<tr>
<td class="address-1"><span id="49581"></span>C1AD</td>
<td class="instruction">LD A,($A0B6)</td>
<td class="comment-1" rowspan="4">if x-position of Rex is less than x-position of MINE then set x-delta to -1</td>
</tr>
<tr>
<td class="address-1"><span id="49584"></span>C1B0</td>
<td class="instruction">CP (IX+$00)</td>
</tr>
<tr>
<td class="address-1"><span id="49587"></span>C1B3</td>
<td class="instruction">JP NC,$C1BA</td>
</tr>
<tr>
<td class="address-1"><span id="49590"></span>C1B6</td>
<td class="instruction">LD (IX+$04),$FF</td>
</tr>
<tr>
<td class="address-2"><span id="49594"></span>C1BA</td>
<td class="instruction">LD (IX+$05),$01</td>
<td class="comment-1" rowspan="1">Set y-delta to 1 for MINE</td>
</tr>
<tr>
<td class="address-1"><span id="49598"></span>C1BE</td>
<td class="instruction">LD A,($A0B7)</td>
<td class="comment-1" rowspan="4">if y-position of Rex is less than y-position of MINE then set y-delta to -1</td>
</tr>
<tr>
<td class="address-1"><span id="49601"></span>C1C1</td>
<td class="instruction">CP (IX+$01)</td>
</tr>
<tr>
<td class="address-1"><span id="49604"></span>C1C4</td>
<td class="instruction">RET NC</td>
</tr>
<tr>
<td class="address-1"><span id="49605"></span>C1C5</td>
<td class="instruction">LD (IX+$05),$FF</td>
</tr>
<tr>
<td class="address-1"><span id="49609"></span>C1C9</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="49481.html">C149</a>
</td>
<td class="up">Up: <a href="../maps/all.html#49485">Map</a></td>
<td class="next">
Next: <a href="49610.html">C1CA</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side A) RAM disassembly 20211106</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>