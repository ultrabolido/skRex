<!DOCTYPE html>
<html>
<head>
<title>Rex: Routine at B5D4</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="46532.html">B5C4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#46548">Map</a></td>
<td class="next">
Next: <a href="46731.html">B68B</a>
</td>
</tr>
</table>
<div class="description">B5D4: Create a new projectile</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="48200.html">BC48</a>, <a href="48975.html">BF4F</a>, <a href="49473.html">C141</a>, <a href="49473.html#49499">C15B</a>, <a href="49473.html#49537">C181</a>, <a href="49473.html#49563">C19B</a> and <a href="49473.html#49587">C1B3</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Address pointer in the projectile configuration buffer</td>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Address pointer in the enemy configuration buffer</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="46548"></span>B5D4</td>
<td class="instruction">LD ($A232),A</td>
<td class="comment-1" rowspan="1">Set <a href="41522.html">A232</a> to the increment for the y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46551"></span>B5D7</td>
<td class="instruction">LD A,(IX+$01)</td>
<td class="comment-1" rowspan="2">Set <a href="41518.html">A22E</a> to enemy y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46554"></span>B5DA</td>
<td class="instruction">LD ($A22E),A</td>
</tr>
<tr>
<td class="address-1"><span id="46557"></span>B5DD</td>
<td class="instruction">LD A,(IX+$02)</td>
<td class="comment-1" rowspan="2">Set <a href="41520.html">A230</a> to enemy face direction</td>
</tr>
<tr>
<td class="address-1"><span id="46560"></span>B5E0</td>
<td class="instruction">LD ($A230),A</td>
</tr>
<tr>
<td class="address-1"><span id="46563"></span>B5E3</td>
<td class="instruction">LD A,($A1ED)</td>
<td class="comment-1" rowspan="2">Set the projectile type to <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="46566"></span>B5E6</td>
<td class="instruction">SET 7,A</td>
</tr>
<tr>
<td class="address-1"><span id="46568"></span>B5E8</td>
<td class="instruction">JP $B607</td>
<td class="comment-1" rowspan="1">Jump to create this projectile</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="46571"></span>
<div class="comments">
<div class="paragraph">
Create a new projectile fired for Rex. Used by the routines at <a href="46008.html">B3B8</a> and <a href="46236.html">B49C</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="46571"></span>B5EB</td>
<td class="instruction">LD A,($A24F)</td>
<td class="comment-1" rowspan="2">Set <a href="41516.html">A22C</a> to Rex x-position</td>
</tr>
<tr>
<td class="address-1"><span id="46574"></span>B5EE</td>
<td class="instruction">LD ($A22C),A</td>
</tr>
<tr>
<td class="address-1"><span id="46577"></span>B5F1</td>
<td class="instruction">LD A,($A250)</td>
<td class="comment-1" rowspan="2">Set <a href="41518.html">A22E</a> to Rex y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46580"></span>B5F4</td>
<td class="instruction">LD ($A22E),A</td>
</tr>
<tr>
<td class="address-1"><span id="46583"></span>B5F7</td>
<td class="instruction">LD A,($A254)</td>
<td class="comment-1" rowspan="2">Set <a href="41520.html">A230</a> to Rex face direction</td>
</tr>
<tr>
<td class="address-1"><span id="46586"></span>B5FA</td>
<td class="instruction">LD ($A230),A</td>
</tr>
<tr>
<td class="address-1"><span id="46589"></span>B5FD</td>
<td class="instruction">LD A,$11</td>
<td class="comment-1" rowspan="2">Set <a href="41522.html">A232</a> to the increment for the y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46591"></span>B5FF</td>
<td class="instruction">LD ($A232),A</td>
</tr>
<tr>
<td class="address-1"><span id="46594"></span>B602</td>
<td class="instruction">LD A,($A1AC)</td>
<td class="comment-1" rowspan="2">Set <span class="register">A</span> to Rex weapon number</td>
</tr>
<tr>
<td class="address-1"><span id="46597"></span>B605</td>
<td class="instruction">RES 7,A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="46599"></span>
<div class="comments">
<div class="paragraph">
Create a new projectile in the projectile configuration buffer based on predefined values. This entry point is used by the routines at <a href="46008.html">B3B8</a>, <a href="46548.html">B5D4</a> and <a href="46731.html#47415">B937</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="46599"></span>B607</td>
<td class="instruction">LD (IY+$06),$01</td>
<td class="comment-1" rowspan="1">Set projectile status to flying</td>
</tr>
<tr>
<td class="address-1"><span id="46603"></span>B60B</td>
<td class="instruction">LD (IY+$0B),A</td>
<td class="comment-1" rowspan="1">Set the projectile type</td>
</tr>
<tr>
<td class="address-1"><span id="46606"></span>B60E</td>
<td class="instruction">LD A,($A22E)</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span> to the y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46609"></span>B611</td>
<td class="instruction">LD HL,$A232</td>
<td class="comment-1" rowspan="2">Increment y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46612"></span>B614</td>
<td class="instruction">ADD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="46613"></span>B615</td>
<td class="instruction">LD (IY+$01),A</td>
<td class="comment-1" rowspan="1">Save y-position of laser to projectile configuration buffer</td>
</tr>
<tr>
<td class="address-1"><span id="46616"></span>B618</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="7">Computes offset on room buffer for y-position. NOT NEEDED HERE!</td>
</tr>
<tr>
<td class="address-1"><span id="46617"></span>B619</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="46619"></span>B61B</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46620"></span>B61C</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46621"></span>B61D</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46622"></span>B61E</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46623"></span>B61F</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46624"></span>B620</td>
<td class="instruction">LD A,($A22C)</td>
<td class="comment-1" rowspan="3">Increment x-position and save it at projectile configuration buffer</td>
</tr>
<tr>
<td class="address-1"><span id="46627"></span>B623</td>
<td class="instruction">ADD A,$10</td>
</tr>
<tr>
<td class="address-1"><span id="46629"></span>B625</td>
<td class="instruction">LD (IY+$00),A</td>
</tr>
<tr>
<td class="address-1"><span id="46632"></span>B628</td>
<td class="instruction">LD A,($A214)</td>
<td class="comment-1" rowspan="2">is Rex firing the wepaon?</td>
</tr>
<tr>
<td class="address-1"><span id="46635"></span>B62B</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="46636"></span>B62C</td>
<td class="instruction">JP NZ,$B640</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="46639"></span>B62F</td>
<td class="instruction">LD A,($A22C)</td>
<td class="comment-1" rowspan="2">Check bits 2-0 of x-position</td>
</tr>
<tr>
<td class="address-1"><span id="46642"></span>B632</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="46644"></span>B634</td>
<td class="instruction">CP $06</td>
<td class="comment-1" rowspan="5">Decrement y-position of laser when Rex is moving Bits 2-0: $06 and $00 decrement y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46646"></span>B636</td>
<td class="instruction">JP Z,$B63D</td>
</tr>
<tr>
<td class="address-1"><span id="46649"></span>B639</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="46650"></span>B63A</td>
<td class="instruction">JP NZ,$B640</td>
</tr>
<tr>
<td class="address-2"><span id="46653"></span>B63D</td>
<td class="instruction">DEC (IY+$01)</td>
</tr>
<tr>
<td class="address-2"><span id="46656"></span>B640</td>
<td class="instruction">LD (IY+$04),$08</td>
<td class="comment-1" rowspan="1">Set x-delta of laser</td>
</tr>
<tr>
<td class="address-1"><span id="46660"></span>B644</td>
<td class="instruction">LD HL,$0001</td>
<td class="comment-1" rowspan="3">Set offset of 1</td>
</tr>
<tr>
<td class="address-1"><span id="46663"></span>B647</td>
<td class="instruction">LD (IY+$07),L</td>
</tr>
<tr>
<td class="address-1"><span id="46666"></span>B64A</td>
<td class="instruction">LD (IY+$08),H</td>
</tr>
<tr>
<td class="address-1"><span id="46669"></span>B64D</td>
<td class="instruction">LD A,($A230)</td>
<td class="comment-1" rowspan="2">is Rex direction facing right</td>
</tr>
<tr>
<td class="address-1"><span id="46672"></span>B650</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="46673"></span>B651</td>
<td class="instruction">JP Z,$B669</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="46676"></span>B654</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="3">Recompute x-position for facing left</td>
</tr>
<tr>
<td class="address-1"><span id="46679"></span>B657</td>
<td class="instruction">SUB $10</td>
</tr>
<tr>
<td class="address-1"><span id="46681"></span>B659</td>
<td class="instruction">LD (IY+$00),A</td>
</tr>
<tr>
<td class="address-1"><span id="46684"></span>B65C</td>
<td class="instruction">LD HL,$FFFF</td>
<td class="comment-1" rowspan="3">Recompute x-offset for facing left (-1)</td>
</tr>
<tr>
<td class="address-1"><span id="46687"></span>B65F</td>
<td class="instruction">LD (IY+$07),L</td>
</tr>
<tr>
<td class="address-1"><span id="46690"></span>B662</td>
<td class="instruction">LD (IY+$08),H</td>
</tr>
<tr>
<td class="address-1"><span id="46693"></span>B665</td>
<td class="instruction">LD (IY+$04),$F8</td>
<td class="comment-1" rowspan="1">Recompute x-delta for facing left</td>
</tr>
<tr>
<td class="address-2"><span id="46697"></span>B669</td>
<td class="instruction">LD L,(IY+$01)</td>
<td class="comment-1" rowspan="7">Computes offset on room buffer for y-position</td>
</tr>
<tr>
<td class="address-1"><span id="46700"></span>B66C</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="46702"></span>B66E</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46703"></span>B66F</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46704"></span>B670</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46705"></span>B671</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46706"></span>B672</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="46707"></span>B673</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="4">Computes offset on room buffer for x-position</td>
</tr>
<tr>
<td class="address-1"><span id="46710"></span>B676</td>
<td class="instruction">SRL A</td>
</tr>
<tr>
<td class="address-1"><span id="46712"></span>B678</td>
<td class="instruction">SRL A</td>
</tr>
<tr>
<td class="address-1"><span id="46714"></span>B67A</td>
<td class="instruction">SRL A</td>
</tr>
<tr>
<td class="address-1"><span id="46716"></span>B67C</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="7">Computes address into room buffer for draw the projectile and save this address into projectile configuration buffer</td>
</tr>
<tr>
<td class="address-1"><span id="46717"></span>B67D</td>
<td class="instruction">LD D,$00</td>
</tr>
<tr>
<td class="address-1"><span id="46719"></span>B67F</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="46720"></span>B680</td>
<td class="instruction">LD DE,$E7FF</td>
</tr>
<tr>
<td class="address-1"><span id="46723"></span>B683</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="46724"></span>B684</td>
<td class="instruction">LD (IY+$02),L</td>
</tr>
<tr>
<td class="address-1"><span id="46727"></span>B687</td>
<td class="instruction">LD (IY+$03),H</td>
</tr>
<tr>
<td class="address-1"><span id="46730"></span>B68A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="46532.html">B5C4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#46548">Map</a></td>
<td class="next">
Next: <a href="46731.html">B68B</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side B) RAM disassembly 20211106</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>