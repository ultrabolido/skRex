<!DOCTYPE html>
<html>
<head>
<title>Rex: Routine at A0F8</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="41133.html">A0AD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#41208">Map</a></td>
<td class="next">
Next: <a href="41387.html">A1AB</a>
</td>
</tr>
</table>
<div class="description">A0F8: Handle Rex over special tiles</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="38000.html">9470</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="41208"></span>A0F8</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Reset Rex on elevtor</td>
</tr>
<tr>
<td class="address-1"><span id="41209"></span>A0F9</td>
<td class="instruction">LD ($A213),A</td>
</tr>
<tr>
<td class="address-1"><span id="41212"></span>A0FC</td>
<td class="instruction">LD HL,($A1B2)</td>
<td class="comment-1" rowspan="3">Set <span class="register">HL</span> to point into tile type buffer data under Rex feet</td>
</tr>
<tr>
<td class="address-1"><span id="41215"></span>A0FF</td>
<td class="instruction">LD DE,$0060</td>
</tr>
<tr>
<td class="address-1"><span id="41218"></span>A102</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="41219"></span>A103</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Check tile type</td>
</tr>
<tr>
<td class="address-1"><span id="41220"></span>A104</td>
<td class="instruction">CP $12</td>
<td class="comment-1" rowspan="2">Jump forward to handle elevator</td>
</tr>
<tr>
<td class="address-1"><span id="41222"></span>A106</td>
<td class="instruction">JP Z,$A130</td>
</tr>
<tr>
<td class="address-1"><span id="41225"></span>A109</td>
<td class="instruction">LD HL,($A1B2)</td>
<td class="comment-1" rowspan="3">Set <span class="register">HL</span> to point into tile type buffer data in front-under Rex feet</td>
</tr>
<tr>
<td class="address-1"><span id="41228"></span>A10C</td>
<td class="instruction">LD DE,$0061</td>
</tr>
<tr>
<td class="address-1"><span id="41231"></span>A10F</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="41232"></span>A110</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Check tile type</td>
</tr>
<tr>
<td class="address-1"><span id="41233"></span>A111</td>
<td class="instruction">CP $07</td>
<td class="comment-1" rowspan="2">Jump to handle respawn</td>
</tr>
<tr>
<td class="address-1"><span id="41235"></span>A113</td>
<td class="instruction">JP Z,<a href="40237.html">$9D2D</a></td>
</tr>
<tr>
<td class="address-1"><span id="41238"></span>A116</td>
<td class="instruction">CP $08</td>
<td class="comment-1" rowspan="2">Jump to handle shield recharging</td>
</tr>
<tr>
<td class="address-1"><span id="41240"></span>A118</td>
<td class="instruction">JP Z,$A187</td>
</tr>
<tr>
<td class="address-1"><span id="41243"></span>A11B</td>
<td class="instruction">CP $0D</td>
<td class="comment-1" rowspan="2">Jump to handle Double fire weapon bonus</td>
</tr>
<tr>
<td class="address-1"><span id="41245"></span>A11D</td>
<td class="instruction">JP Z,$A14B</td>
</tr>
<tr>
<td class="address-1"><span id="41248"></span>A120</td>
<td class="instruction">CP $0A</td>
<td class="comment-1" rowspan="2">Jump to handle laser weapon bonus</td>
</tr>
<tr>
<td class="address-1"><span id="41250"></span>A122</td>
<td class="instruction">JP Z,$A15A</td>
</tr>
<tr>
<td class="address-1"><span id="41253"></span>A125</td>
<td class="instruction">CP $0B</td>
<td class="comment-1" rowspan="2">Jump to handle multiple weapon bonus</td>
</tr>
<tr>
<td class="address-1"><span id="41255"></span>A127</td>
<td class="instruction">JP Z,$A169</td>
</tr>
<tr>
<td class="address-1"><span id="41258"></span>A12A</td>
<td class="instruction">CP $0C</td>
<td class="comment-1" rowspan="2">Jump to handle spray weapon bonus</td>
</tr>
<tr>
<td class="address-1"><span id="41260"></span>A12C</td>
<td class="instruction">JP Z,$A178</td>
</tr>
<tr>
<td class="address-1"><span id="41263"></span>A12F</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="41264"></span>
<div class="comments">
<div class="paragraph">
handle Rex on elevator
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="41264"></span>A130</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Reset speed Rex</td>
</tr>
<tr>
<td class="address-1"><span id="41265"></span>A131</td>
<td class="instruction">LD ($A22A),A</td>
</tr>
<tr>
<td class="address-1"><span id="41268"></span>A134</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="2">Set Rex on elevator</td>
</tr>
<tr>
<td class="address-1"><span id="41270"></span>A136</td>
<td class="instruction">LD ($A213),A</td>
</tr>
<tr>
<td class="address-1"><span id="41273"></span>A139</td>
<td class="instruction">LD A,($A250)</td>
<td class="comment-1" rowspan="4">Return if Rex is not grid fixed</td>
</tr>
<tr>
<td class="address-1"><span id="41276"></span>A13C</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="41278"></span>A13E</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="41279"></span>A13F</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41280"></span>A140</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Set falling speed to zero</td>
</tr>
<tr>
<td class="address-1"><span id="41281"></span>A141</td>
<td class="instruction">LD ($A255),A</td>
</tr>
<tr>
<td class="address-1"><span id="41284"></span>A144</td>
<td class="instruction">CALL <a href="52852.html#52914">$CEB2</a></td>
<td class="comment-1" rowspan="1">Configure Rex for falling - Does nothing</td>
</tr>
<tr>
<td class="address-1"><span id="41287"></span>A147</td>
<td class="instruction">CALL <a href="52818.html">$CE52</a></td>
<td class="comment-1" rowspan="1">Configure Rex for jump</td>
</tr>
<tr>
<td class="address-1"><span id="41290"></span>A14A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="41291"></span>
<div class="comments">
<div class="paragraph">
handle double fire weapon bonus
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="41291"></span>A14B</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Return if next tile is not the same type</td>
</tr>
<tr>
<td class="address-1"><span id="41292"></span>A14C</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="41293"></span>A14D</td>
<td class="instruction">CP $0D</td>
</tr>
<tr>
<td class="address-1"><span id="41295"></span>A14F</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41296"></span>A150</td>
<td class="instruction">CALL <a href="43254.html">$A8F6</a></td>
<td class="comment-1" rowspan="1">Update weapon in inventory (HUD)</td>
</tr>
<tr>
<td class="address-1"><span id="41299"></span>A153</td>
<td class="instruction">LD HL,$AC5D</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the base address for text definition of DOUBLE FIRE weapon</td>
</tr>
<tr>
<td class="address-1"><span id="41302"></span>A156</td>
<td class="instruction">CALL <a href="54793.html">$D609</a></td>
<td class="comment-1" rowspan="1">Show weapon bonus windows</td>
</tr>
<tr>
<td class="address-1"><span id="41305"></span>A159</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="41306"></span>
<div class="comments">
<div class="paragraph">
handle laser weapon bonus
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="41306"></span>A15A</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Return if next tile is not the same type</td>
</tr>
<tr>
<td class="address-1"><span id="41307"></span>A15B</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="41308"></span>A15C</td>
<td class="instruction">CP $0A</td>
</tr>
<tr>
<td class="address-1"><span id="41310"></span>A15E</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41311"></span>A15F</td>
<td class="instruction">CALL <a href="43254.html#43260">$A8FC</a></td>
<td class="comment-1" rowspan="1">Update weapon in inventory (HUD)</td>
</tr>
<tr>
<td class="address-1"><span id="41314"></span>A162</td>
<td class="instruction">LD HL,$AC6E</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the base address for text definition of LASER weapon</td>
</tr>
<tr>
<td class="address-1"><span id="41317"></span>A165</td>
<td class="instruction">CALL <a href="54793.html">$D609</a></td>
<td class="comment-1" rowspan="1">Show weapon bonus windows</td>
</tr>
<tr>
<td class="address-1"><span id="41320"></span>A168</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="41321"></span>
<div class="comments">
<div class="paragraph">
handle multiple weapon bonus
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="41321"></span>A169</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Return if next tile is not the same type</td>
</tr>
<tr>
<td class="address-1"><span id="41322"></span>A16A</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="41323"></span>A16B</td>
<td class="instruction">CP $0B</td>
</tr>
<tr>
<td class="address-1"><span id="41325"></span>A16D</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41326"></span>A16E</td>
<td class="instruction">CALL <a href="43254.html#43266">$A902</a></td>
<td class="comment-1" rowspan="1">Update weapon in inventory (HUD)</td>
</tr>
<tr>
<td class="address-1"><span id="41329"></span>A171</td>
<td class="instruction">LD HL,$AC79</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the base address for text definition of MULTIPLE weapon</td>
</tr>
<tr>
<td class="address-1"><span id="41332"></span>A174</td>
<td class="instruction">CALL <a href="54793.html">$D609</a></td>
<td class="comment-1" rowspan="1">Show weapon bonus windows</td>
</tr>
<tr>
<td class="address-1"><span id="41335"></span>A177</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="41336"></span>
<div class="comments">
<div class="paragraph">
handle spray weapon bonus
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="41336"></span>A178</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Return if next tile is not the same type</td>
</tr>
<tr>
<td class="address-1"><span id="41337"></span>A179</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="41338"></span>A17A</td>
<td class="instruction">CP $0C</td>
</tr>
<tr>
<td class="address-1"><span id="41340"></span>A17C</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41341"></span>A17D</td>
<td class="instruction">CALL <a href="43254.html#43272">$A908</a></td>
<td class="comment-1" rowspan="1">Update weapon in inventory (HUD)</td>
</tr>
<tr>
<td class="address-1"><span id="41344"></span>A180</td>
<td class="instruction">LD HL,$AC87</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the base address for text definition of SPRAY weapon</td>
</tr>
<tr>
<td class="address-1"><span id="41347"></span>A183</td>
<td class="instruction">CALL <a href="54793.html">$D609</a></td>
<td class="comment-1" rowspan="1">Show weapon bonus windows</td>
</tr>
<tr>
<td class="address-1"><span id="41350"></span>A186</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="41351"></span>
<div class="comments">
<div class="paragraph">
handle shield recharging
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="41351"></span>A187</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Return if next tile is not the same type</td>
</tr>
<tr>
<td class="address-1"><span id="41352"></span>A188</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="41353"></span>A189</td>
<td class="instruction">CP $08</td>
</tr>
<tr>
<td class="address-1"><span id="41355"></span>A18B</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41356"></span>A18C</td>
<td class="instruction">LD A,($A1E2)</td>
<td class="comment-1" rowspan="3">Return if shield active</td>
</tr>
<tr>
<td class="address-1"><span id="41359"></span>A18F</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="41360"></span>A190</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41361"></span>A191</td>
<td class="instruction">LD A,($A1E6)</td>
<td class="comment-1" rowspan="2">Increment shield power</td>
</tr>
<tr>
<td class="address-1"><span id="41364"></span>A194</td>
<td class="instruction">INC A</td>
</tr>
<tr>
<td class="address-1"><span id="41365"></span>A195</td>
<td class="instruction">CP $64</td>
<td class="comment-1" rowspan="2">Return if shield power = 100</td>
</tr>
<tr>
<td class="address-1"><span id="41367"></span>A197</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="41368"></span>A198</td>
<td class="instruction">LD ($A1E6),A</td>
<td class="comment-1" rowspan="1">Set the new shield power</td>
</tr>
<tr>
<td class="address-1"><span id="41371"></span>A19B</td>
<td class="instruction">CALL <a href="39192.html">$9918</a></td>
<td class="comment-1" rowspan="1">Draw shield power</td>
</tr>
<tr>
<td class="address-1"><span id="41374"></span>A19E</td>
<td class="instruction">LD A,($D5D2)</td>
<td class="comment-1" rowspan="3">Return if channel 2 in use</td>
</tr>
<tr>
<td class="address-1"><span id="41377"></span>A1A1</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address-1"><span id="41379"></span>A1A3</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="41380"></span>A1A4</td>
<td class="instruction">LD DE,$D5BE</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> to the shield recharging sound</td>
</tr>
<tr>
<td class="address-1"><span id="41383"></span>A1A7</td>
<td class="instruction">CALL <a href="54143.html">$D37F</a></td>
<td class="comment-1" rowspan="1">Configure sound channel and mixer register</td>
</tr>
<tr>
<td class="address-1"><span id="41386"></span>A1AA</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="41133.html">A0AD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#41208">Map</a></td>
<td class="next">
Next: <a href="41387.html">A1AB</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side B) RAM disassembly 20211106</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>