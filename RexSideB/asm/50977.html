<!DOCTYPE html>
<html>
<head>
<title>Rex: Routine at C721</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="50833.html">C691</a>
</td>
<td class="up">Up: <a href="../maps/all.html#50977">Map</a></td>
<td class="next">
Next: <a href="51092.html">C794</a>
</td>
</tr>
</table>
<div class="description">C721: Handler for FOOT MAN falling</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="48200.html">BC48</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="50977"></span>C721</td>
<td class="instruction">LD A,(IX+$09)</td>
<td class="comment-1" rowspan="4">Return if enemy is TRIANGLE</td>
</tr>
<tr>
<td class="address-1"><span id="50980"></span>C724</td>
<td class="instruction">AND $7F</td>
</tr>
<tr>
<td class="address-1"><span id="50982"></span>C726</td>
<td class="instruction">CP $0E</td>
</tr>
<tr>
<td class="address-1"><span id="50984"></span>C728</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="50985"></span>C729</td>
<td class="instruction">LD A,(IX+$03)</td>
<td class="comment-1" rowspan="3">Return if FOOT MAN is jumping</td>
</tr>
<tr>
<td class="address-1"><span id="50988"></span>C72C</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="50989"></span>C72D</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="50990"></span>C72E</td>
<td class="instruction">LD A,(IX+$01)</td>
<td class="comment-1" rowspan="2">Add to y-position the falling speed</td>
</tr>
<tr>
<td class="address-1"><span id="50993"></span>C731</td>
<td class="instruction">ADD A,(IX+$06)</td>
</tr>
<tr>
<td class="address-1"><span id="50996"></span>C734</td>
<td class="instruction">CP $B8</td>
<td class="comment-1" rowspan="1">y-position is greater than 184?</td>
</tr>
<tr>
<td class="address-1"><span id="50998"></span>C736</td>
<td class="instruction">JP NC,$C77B</td>
<td class="comment-1" rowspan="1">Jump to make FOOTMAN invisible</td>
</tr>
<tr>
<td class="address-1"><span id="51001"></span>C739</td>
<td class="instruction">LD (IX+$01),A</td>
<td class="comment-1" rowspan="1">Set the new y-position</td>
</tr>
<tr>
<td class="address-1"><span id="51004"></span>C73C</td>
<td class="instruction">AND $07</td>
<td class="comment-1" rowspan="3">Return if y-position is not grid fixed</td>
</tr>
<tr>
<td class="address-1"><span id="51006"></span>C73E</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="51007"></span>C73F</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="51008"></span>C740</td>
<td class="instruction">CALL <a href="51092.html">$C794</a></td>
<td class="comment-1" rowspan="1">Obtain into <span class="register">HL</span> the tile type address pointer under FOOT MAN</td>
</tr>
<tr>
<td class="address-1"><span id="51011"></span>C743</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span> the tile type under FOOT MAN</td>
</tr>
<tr>
<td class="address-1"><span id="51012"></span>C744</td>
<td class="instruction">CALL <a href="52725.html#52759">$CE17</a></td>
<td class="comment-1" rowspan="1">Check if tile type is 'background' tile</td>
</tr>
<tr>
<td class="address-1"><span id="51015"></span>C747</td>
<td class="instruction">JP NZ,$C76E</td>
<td class="comment-1" rowspan="1">Jump if wall tile type</td>
</tr>
<tr>
<td class="address-1"><span id="51018"></span>C74A</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="51019"></span>C74B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span> the tile type under FOOT MAN</td>
</tr>
<tr>
<td class="address-1"><span id="51020"></span>C74C</td>
<td class="instruction">CALL <a href="52725.html#52759">$CE17</a></td>
<td class="comment-1" rowspan="1">Check if tile type is 'background' tile</td>
</tr>
<tr>
<td class="address-1"><span id="51023"></span>C74F</td>
<td class="instruction">JP NZ,$C76E</td>
<td class="comment-1" rowspan="1">Jump if wall tile type</td>
</tr>
<tr>
<td class="address-1"><span id="51026"></span>C752</td>
<td class="instruction">LD A,(IX+$09)</td>
<td class="comment-1" rowspan="3">If explosion jump to continue falling</td>
</tr>
<tr>
<td class="address-1"><span id="51029"></span>C755</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address-1"><span id="51031"></span>C757</td>
<td class="instruction">JP Z,$C762</td>
</tr>
<tr>
<td class="address-1"><span id="51034"></span>C75A</td>
<td class="instruction">LD A,($A25D)</td>
<td class="comment-1" rowspan="3">If FOOT MAN collides with tile type $03 (tiles of death) then jump to destroy enemy</td>
</tr>
<tr>
<td class="address-1"><span id="51037"></span>C75D</td>
<td class="instruction">CP $03</td>
</tr>
<tr>
<td class="address-1"><span id="51039"></span>C75F</td>
<td class="instruction">CALL Z,$C78C</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="51042"></span>
<div class="comments">
<div class="paragraph">
continue falling
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="51042"></span>C762</td>
<td class="instruction">LD A,(IX+$06)</td>
<td class="comment-1" rowspan="5">Increment falling speed by 2 if speed less than $04</td>
</tr>
<tr>
<td class="address-1"><span id="51045"></span>C765</td>
<td class="instruction">ADD A,$02</td>
</tr>
<tr>
<td class="address-1"><span id="51047"></span>C767</td>
<td class="instruction">CP $06</td>
</tr>
<tr>
<td class="address-1"><span id="51049"></span>C769</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="51050"></span>C76A</td>
<td class="instruction">LD (IX+$06),A</td>
</tr>
<tr>
<td class="address-1"><span id="51053"></span>C76D</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="51054"></span>
<div class="comments">
<div class="paragraph">
stop falling
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="51054"></span>C76E</td>
<td class="instruction">LD (IX+$06),$00</td>
<td class="comment-1" rowspan="1">Reset falling</td>
</tr>
<tr>
<td class="address-1"><span id="51058"></span>C772</td>
<td class="instruction">LD A,(IX+$09)</td>
<td class="comment-1" rowspan="3">if enemy is FOOT MAN dying then destroy it</td>
</tr>
<tr>
<td class="address-1"><span id="51061"></span>C775</td>
<td class="instruction">CP $07</td>
</tr>
<tr>
<td class="address-1"><span id="51063"></span>C777</td>
<td class="instruction">JP Z,<a href="38919.html">$9807</a></td>
</tr>
<tr>
<td class="address-1"><span id="51066"></span>C77A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="51067"></span>
<div class="comments">
<div class="paragraph">
enemy falling from screen
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="51067"></span>C77B</td>
<td class="instruction">LD (IX+$0C),$00</td>
<td class="comment-1" rowspan="1">Set entity invisble</td>
</tr>
<tr>
<td class="address-1"><span id="51071"></span>C77F</td>
<td class="instruction">LD HL,$E9FF</td>
<td class="comment-1" rowspan="2">Set base address into attribute buffer for score points</td>
</tr>
<tr>
<td class="address-1"><span id="51074"></span>C782</td>
<td class="instruction">LD ($A1D2),HL</td>
</tr>
<tr>
<td class="address-1"><span id="51077"></span>C785</td>
<td class="instruction">LD HL,$0000</td>
<td class="comment-1" rowspan="2">Set score point to zero</td>
</tr>
<tr>
<td class="address-1"><span id="51080"></span>C788</td>
<td class="instruction">LD ($A1D5),HL</td>
</tr>
<tr>
<td class="address-1"><span id="51083"></span>C78B</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="51084"></span>
<div class="comments">
<div class="paragraph">
enemy collides with tile of death
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="51084"></span>C78C</td>
<td class="instruction">LD (IX+$15),$FF</td>
<td class="comment-1" rowspan="1">Set to not generate bubble</td>
</tr>
<tr>
<td class="address-1"><span id="51088"></span>C790</td>
<td class="instruction">CALL <a href="38919.html">$9807</a></td>
<td class="comment-1" rowspan="1">Destroy enemy</td>
</tr>
<tr>
<td class="address-1"><span id="51091"></span>C793</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="50833.html">C691</a>
</td>
<td class="up">Up: <a href="../maps/all.html#50977">Map</a></td>
<td class="next">
Next: <a href="51092.html">C794</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side B) RAM disassembly 20211106</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>