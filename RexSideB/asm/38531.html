<!DOCTYPE html>
<html>
<head>
<title>Rex: Routine at 9683</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="38503.html">9667</a>
</td>
<td class="up">Up: <a href="../maps/all.html#38531">Map</a></td>
<td class="next">
Next: <a href="38705.html">9731</a>
</td>
</tr>
</table>
<div class="description">9683: Draw Rex and shield</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="38000.html">9470</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="38531"></span>9683</td>
<td class="instruction">LD A,($A1F6)</td>
<td class="comment-1" rowspan="3">Return if Rex is not visible</td>
</tr>
<tr>
<td class="address-1"><span id="38534"></span>9686</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="38535"></span>9687</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="38536"></span>9688</td>
<td class="instruction">LD A,($A1EE)</td>
<td class="comment-1" rowspan="3">Jump to handle dead animation if Rex is dead</td>
</tr>
<tr>
<td class="address-1"><span id="38539"></span>968B</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="38540"></span>968C</td>
<td class="instruction">JP NZ,<a href="39847.html">$9BA7</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="38543"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="39847.html">9BA7</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="38543"></span>968F</td>
<td class="instruction">LD A,($A24F)</td>
<td class="comment-1" rowspan="2">Set <a href="41544.html">A248</a> the x-position of Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38546"></span>9692</td>
<td class="instruction">LD ($A248),A</td>
</tr>
<tr>
<td class="address-1"><span id="38549"></span>9695</td>
<td class="instruction">LD A,($A250)</td>
<td class="comment-1" rowspan="2">Set <a href="41545.html">A249</a> the y-position of Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38552"></span>9698</td>
<td class="instruction">LD ($A249),A</td>
</tr>
<tr>
<td class="address-1"><span id="38555"></span>969B</td>
<td class="instruction">LD A,$03</td>
<td class="comment-1" rowspan="2">Set <a href="41546.html">A24A</a> the width in bytes of Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38557"></span>969D</td>
<td class="instruction">LD ($A24A),A</td>
</tr>
<tr>
<td class="address-1"><span id="38560"></span>96A0</td>
<td class="instruction">LD A,$10</td>
<td class="comment-1" rowspan="2">Set <a href="41547.html">A24B</a> the height in pixels of Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38562"></span>96A2</td>
<td class="instruction">LD ($A24B),A</td>
</tr>
<tr>
<td class="address-1"><span id="38565"></span>96A5</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Set the entity type for Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38566"></span>96A6</td>
<td class="instruction">LD ($A1CC),A</td>
</tr>
<tr>
<td class="address-1"><span id="38569"></span>96A9</td>
<td class="instruction">LD HL,$AF52</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the address for the offset animation for Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38572"></span>96AC</td>
<td class="instruction">LD DE,$8418</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> the address for graphic data of Rex falling/jumping</td>
</tr>
<tr>
<td class="address-1"><span id="38575"></span>96AF</td>
<td class="instruction">LD A,($A213)</td>
<td class="comment-1" rowspan="3">Jump forward if Rex on elevator</td>
</tr>
<tr>
<td class="address-1"><span id="38578"></span>96B2</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="38579"></span>96B3</td>
<td class="instruction">JP NZ,$96C4</td>
</tr>
<tr>
<td class="address-1"><span id="38582"></span>96B6</td>
<td class="instruction">LD A,($A256)</td>
<td class="comment-1" rowspan="3">Jump forward if Rex is jumping</td>
</tr>
<tr>
<td class="address-1"><span id="38585"></span>96B9</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="38586"></span>96BA</td>
<td class="instruction">JP NZ,$96CA</td>
</tr>
<tr>
<td class="address-1"><span id="38589"></span>96BD</td>
<td class="instruction">LD A,($A255)</td>
<td class="comment-1" rowspan="3">Jump forward if Rex is falling</td>
</tr>
<tr>
<td class="address-1"><span id="38592"></span>96C0</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="38593"></span>96C1</td>
<td class="instruction">JP NZ,$96CA</td>
</tr>
<tr>
<td class="address-2"><span id="38596"></span>96C4</td>
<td class="instruction">LD HL,$AF52</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the address for the offset animation for Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38599"></span>96C7</td>
<td class="instruction">LD DE,$8358</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> the address for graphic data of Rex walking</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="38602"></span>
<div class="comments">
<div class="paragraph">
Rex is falling or jumping
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="38602"></span>96CA</td>
<td class="instruction">LD A,($A254)</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span> the facing direction of Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38605"></span>96CD</td>
<td class="instruction">CALL <a href="45718.html">$B296</a></td>
<td class="comment-1" rowspan="1">Draw Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38608"></span>96D0</td>
<td class="instruction">LD A,($A1E2)</td>
<td class="comment-1" rowspan="3">Return if shield not active</td>
</tr>
<tr>
<td class="address-1"><span id="38611"></span>96D3</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="38612"></span>96D4</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="38613"></span>
<div class="comments">
<div class="paragraph">
draw shield
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="38613"></span>96D5</td>
<td class="instruction">LD A,($D5D2)</td>
<td class="comment-1" rowspan="3">Jump forward if channel 2 is playing</td>
</tr>
<tr>
<td class="address-1"><span id="38616"></span>96D8</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address-1"><span id="38618"></span>96DA</td>
<td class="instruction">JP NZ,$96F2</td>
</tr>
<tr>
<td class="address-1"><span id="38621"></span>96DD</td>
<td class="instruction">CALL <a href="42269.html">$A51D</a></td>
<td class="comment-1" rowspan="2">Set <span class="register">A</span> to a pseudo random number between 0-31</td>
</tr>
<tr>
<td class="address-1"><span id="38624"></span>96E0</td>
<td class="instruction">AND $1F</td>
</tr>
<tr>
<td class="address-1"><span id="38626"></span>96E2</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="5">Configure random fine/noise pitch into shield sound data</td>
</tr>
<tr>
<td class="address-1"><span id="38627"></span>96E3</td>
<td class="instruction">LD D,$00</td>
</tr>
<tr>
<td class="address-1"><span id="38629"></span>96E5</td>
<td class="instruction">LD HL,$04B0</td>
</tr>
<tr>
<td class="address-1"><span id="38632"></span>96E8</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="38633"></span>96E9</td>
<td class="instruction">LD ($D538),HL</td>
</tr>
<tr>
<td class="address-1"><span id="38636"></span>96EC</td>
<td class="instruction">LD DE,$D534</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> to play shield sound</td>
</tr>
<tr>
<td class="address-1"><span id="38639"></span>96EF</td>
<td class="instruction">CALL <a href="54143.html">$D37F</a></td>
<td class="comment-1" rowspan="1">Configure sound channel and mixer register</td>
</tr>
<tr>
<td class="address-2"><span id="38642"></span>96F2</td>
<td class="instruction">LD L,$01</td>
<td class="comment-1" rowspan="2">Decrease 1 shield point</td>
</tr>
<tr>
<td class="address-1"><span id="38644"></span>96F4</td>
<td class="instruction">CALL <a href="39148.html#39153">$98F1</a></td>
</tr>
<tr>
<td class="address-1"><span id="38647"></span>96F7</td>
<td class="instruction">LD A,($A24F)</td>
<td class="comment-1" rowspan="3">Set <a href="41544.html">A248</a> the x-position for the shield</td>
</tr>
<tr>
<td class="address-1"><span id="38650"></span>96FA</td>
<td class="instruction">SUB $04</td>
</tr>
<tr>
<td class="address-1"><span id="38652"></span>96FC</td>
<td class="instruction">LD ($A248),A</td>
</tr>
<tr>
<td class="address-1"><span id="38655"></span>96FF</td>
<td class="instruction">LD A,($A254)</td>
<td class="comment-1" rowspan="3">Jump forward if Rex facing right</td>
</tr>
<tr>
<td class="address-1"><span id="38658"></span>9702</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="38659"></span>9703</td>
<td class="instruction">JP Z,$970E</td>
</tr>
<tr>
<td class="address-1"><span id="38662"></span>9706</td>
<td class="instruction">LD A,($A248)</td>
<td class="comment-1" rowspan="3">Increment x-position of shield if Rex is facing left</td>
</tr>
<tr>
<td class="address-1"><span id="38665"></span>9709</td>
<td class="instruction">ADD A,$08</td>
</tr>
<tr>
<td class="address-1"><span id="38667"></span>970B</td>
<td class="instruction">LD ($A248),A</td>
</tr>
<tr>
<td class="address-2"><span id="38670"></span>970E</td>
<td class="instruction">LD A,($A250)</td>
<td class="comment-1" rowspan="3">Set <a href="41545.html">A249</a> the y-position for the shield</td>
</tr>
<tr>
<td class="address-1"><span id="38673"></span>9711</td>
<td class="instruction">SUB $02</td>
</tr>
<tr>
<td class="address-1"><span id="38675"></span>9713</td>
<td class="instruction">LD ($A249),A</td>
</tr>
<tr>
<td class="address-1"><span id="38678"></span>9716</td>
<td class="instruction">LD A,$04</td>
<td class="comment-1" rowspan="2">Set <a href="41546.html">A24A</a> the width in bytes of the shield</td>
</tr>
<tr>
<td class="address-1"><span id="38680"></span>9718</td>
<td class="instruction">LD ($A24A),A</td>
</tr>
<tr>
<td class="address-1"><span id="38683"></span>971B</td>
<td class="instruction">LD A,$15</td>
<td class="comment-1" rowspan="2">Set <a href="41547.html">A24B</a> the height in pixels of the shield</td>
</tr>
<tr>
<td class="address-1"><span id="38685"></span>971D</td>
<td class="instruction">LD ($A24B),A</td>
</tr>
<tr>
<td class="address-1"><span id="38688"></span>9720</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Set entity type of #0</td>
</tr>
<tr>
<td class="address-1"><span id="38689"></span>9721</td>
<td class="instruction">LD ($A1CC),A</td>
</tr>
<tr>
<td class="address-1"><span id="38692"></span>9724</td>
<td class="instruction">LD HL,$AF5A</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the address pointer for shield offsets</td>
</tr>
<tr>
<td class="address-1"><span id="38695"></span>9727</td>
<td class="instruction">LD DE,$8918</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> the address pointer for shield graphic data</td>
</tr>
<tr>
<td class="address-1"><span id="38698"></span>972A</td>
<td class="instruction">LD A,($A254)</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span> the face direction of Rex</td>
</tr>
<tr>
<td class="address-1"><span id="38701"></span>972D</td>
<td class="instruction">CALL <a href="45718.html">$B296</a></td>
<td class="comment-1" rowspan="1">Draw shield</td>
</tr>
<tr>
<td class="address-1"><span id="38704"></span>9730</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="38503.html">9667</a>
</td>
<td class="up">Up: <a href="../maps/all.html#38531">Map</a></td>
<td class="next">
Next: <a href="38705.html">9731</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side B) RAM disassembly 20211106</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>