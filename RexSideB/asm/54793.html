<!DOCTYPE html>
<html>
<head>
<title>Rex: Routine at D609</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../rex.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/scr/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="54768.html">D5F0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#54793">Map</a></td>
<td class="next">
Next: <a href="54872.html">D658</a>
</td>
</tr>
</table>
<div class="description">D609: Show weapon bonus windows</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This entry point is used by the routine at <a href="41208.html">A0F8</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="54793"></span>D609</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="3">Return if weapon has been collected previously</td>
</tr>
<tr>
<td class="address-1"><span id="54794"></span>D60A</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="54795"></span>D60B</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="54796"></span>D60C</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-1" rowspan="1">Set weapon collected in text definition buffer</td>
</tr>
<tr>
<td class="address-1"><span id="54798"></span>D60E</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Set <span class="register">HL</span> the number of lines to draw on windows</td>
</tr>
<tr>
<td class="address-1"><span id="54799"></span>D60F</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="54800"></span>D610</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> to text definition data</td>
</tr>
<tr>
<td class="address-1"><span id="54801"></span>D611</td>
<td class="instruction">PUSH IX</td>
<td class="comment-1" rowspan="3">Save <span class="register">IX</span>, <span class="register">IY</span> and <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="54803"></span>D613</td>
<td class="instruction">PUSH IY</td>
</tr>
<tr>
<td class="address-1"><span id="54805"></span>D615</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address-1"><span id="54806"></span>D616</td>
<td class="instruction">CALL <a href="54127.html">$D36F</a></td>
<td class="comment-1" rowspan="1">Reset channel volumes</td>
</tr>
<tr>
<td class="address-1"><span id="54809"></span>D619</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="2">Copy <span class="register">HL</span> into <span class="register">IX</span></td>
</tr>
<tr>
<td class="address-1"><span id="54810"></span>D61A</td>
<td class="instruction">POP IX</td>
</tr>
<tr>
<td class="address-1"><span id="54812"></span>D61C</td>
<td class="instruction">CALL $D63B</td>
<td class="comment-1" rowspan="1">Copy screen display file into room graphic data buffer</td>
</tr>
<tr>
<td class="address-1"><span id="54815"></span>D61F</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span> the number of lines to draw</td>
</tr>
<tr>
<td class="address-1"><span id="54816"></span>D620</td>
<td class="instruction">CALL <a href="41702.html">$A2E6</a></td>
<td class="comment-1" rowspan="1">Draw windows with weapon text</td>
</tr>
<tr>
<td class="address-1"><span id="54819"></span>D623</td>
<td class="instruction">LD BC,$2710</td>
<td class="comment-1" rowspan="1">Set <span class="register">BC</span> = 10.000</td>
</tr>
<tr>
<td class="address-1"><span id="54822"></span>D626</td>
<td class="instruction">CALL $C94E</td>
<td class="comment-1" rowspan="1">Wait some time ~0.5s (128 t-states 10.000 times)</td>
</tr>
<tr>
<td class="address-1"><span id="54825"></span>D629</td>
<td class="instruction">CALL <a href="38827.html">$97AB</a></td>
<td class="comment-1" rowspan="1">Reset sound buffer, volume channels and check for FIRE key</td>
</tr>
<tr>
<td class="address-1"><span id="54828"></span>D62C</td>
<td class="instruction">CALL <a href="42034.html">$A432</a></td>
<td class="comment-1" rowspan="1">Copy room graphic buffer to display file</td>
</tr>
<tr>
<td class="address-1"><span id="54831"></span>D62F</td>
<td class="instruction">CALL <a href="51506.html">$C932</a></td>
<td class="comment-1" rowspan="1">Copy room color attribute buffer to attribute file</td>
</tr>
<tr>
<td class="address-1"><span id="54834"></span>D632</td>
<td class="instruction">CALL <a href="54086.html">$D346</a></td>
<td class="comment-1" rowspan="1">Reset sound data buffer</td>
</tr>
<tr>
<td class="address-1"><span id="54837"></span>D635</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="3">Restore <span class="register">BC</span>, <span class="register">IY</span> and #rEGix</td>
</tr>
<tr>
<td class="address-1"><span id="54838"></span>D636</td>
<td class="instruction">POP IY</td>
</tr>
<tr>
<td class="address-1"><span id="54840"></span>D638</td>
<td class="instruction">POP IX</td>
</tr>
<tr>
<td class="address-1"><span id="54842"></span>D63A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="54843"></span>
<div class="comments">
<div class="paragraph">
Copy screen display file into room graphic data buffer
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="54843"></span>D63B</td>
<td class="instruction">LD IY,$ACCA</td>
<td class="comment-1" rowspan="1">Set <span class="register">IY</span> to the address into the display lookup table</td>
</tr>
<tr>
<td class="address-1"><span id="54847"></span>D63F</td>
<td class="instruction">LD B,$A8</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span> to the number of pixel-rows to copy</td>
</tr>
<tr>
<td class="address-1"><span id="54849"></span>D641</td>
<td class="instruction">LD DE,$EAFF</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> to the base address for the room graphic buffer</td>
</tr>
<tr>
<td class="address-2"><span id="54852"></span>D644</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save REGbc</td>
</tr>
<tr>
<td class="address-1"><span id="54853"></span>D645</td>
<td class="instruction">LD L,(IY+$00)</td>
<td class="comment-1" rowspan="4">Copy a pixel-row from display file to room graphic data</td>
</tr>
<tr>
<td class="address-1"><span id="54856"></span>D648</td>
<td class="instruction">LD H,(IY+$01)</td>
</tr>
<tr>
<td class="address-1"><span id="54859"></span>D64B</td>
<td class="instruction">LD BC,$0020</td>
</tr>
<tr>
<td class="address-1"><span id="54862"></span>D64E</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="address-1"><span id="54864"></span>D650</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="2">Increment address into the display lookup table</td>
</tr>
<tr>
<td class="address-1"><span id="54866"></span>D652</td>
<td class="instruction">INC IY</td>
</tr>
<tr>
<td class="address-1"><span id="54868"></span>D654</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="54869"></span>D655</td>
<td class="instruction">DJNZ $D644</td>
<td class="comment-1" rowspan="1">Jump back until all the screen copied</td>
</tr>
<tr>
<td class="address-1"><span id="54871"></span>D657</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="54768.html">D5F0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#54793">Map</a></td>
<td class="next">
Next: <a href="54872.html">D658</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Rex (Side B) RAM disassembly 20211106</div>
<div class="copyright">&#169; 1988 Martech Games Ltd. &#169; 2021 Andreu Font.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.5.</div>
</footer>
</body>
</html>